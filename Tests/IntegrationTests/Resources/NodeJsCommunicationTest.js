(() => { "use strict"; var e = { 97: (e, t) => { Object.defineProperty(t, "__esModule", { value: !0 }), t.LOCAL_PORT = void 0, t.LOCAL_PORT = 9694 }, 153: (e, t, o) => { Object.defineProperty(t, "__esModule", { value: !0 }), t.CommandProcessor = void 0; const n = o(910); t.CommandProcessor = class { commandHandlers; constructor(e) { this.commandHandlers = e } onReceived(e, t) { const o = JSON.parse(t); if (!o.cmd) return void console.log(`Received invalid commmand: ${t}`); const r = this.commandHandlers.get(o.cmd); r ? r.handle(o.pl, o.id ? new n.RequestContext(e, o.id) : void 0) : console.log(`Unknown command: ${o.cmd}`) } } }, 910: (e, t, o) => { Object.defineProperty(t, "__esModule", { value: !0 }), t.RequestContext = void 0; const n = o(464); t.RequestContext = class { source; requestId; constructor(e, t) { this.source = e, this.requestId = t } respond(e) { this.source.send(JSON.stringify((0, n.responseCommand)(this.requestId, e))) } } }, 464: (e, t) => { Object.defineProperty(t, "__esModule", { value: !0 }), t.responseCommand = function (e, t) { return { id: e, pl: t } } }, 988: (e, t, o) => { Object.defineProperty(t, "__esModule", { value: !0 }), t.FrameDecodeContext = void 0; const n = o(894), r = Buffer.alloc(0); t.FrameDecodeContext = class { last = r; decode(e) { if (0 === e.length) return []; const t = (0, n.splitBufferByTerminator)(e); if (0 === t.length) return []; const [o] = t; if (this.last = Buffer.concat([this.last, o]), 1 === t.length) return []; const s = []; this.last.length > 0 && (s.push(this.last.toString()), this.last = r); for (let e = 1; e < t.length - 1; e++)s.push(t[e].toString()); const c = t[t.length - 1]; return c && (this.last = c), s } } }, 987: function (e, t, o) { var n, r = this && this.__createBinding || (Object.create ? function (e, t, o, n) { void 0 === n && (n = o); var r = Object.getOwnPropertyDescriptor(t, o); r && !("get" in r ? !t.__esModule : r.writable || r.configurable) || (r = { enumerable: !0, get: function () { return t[o] } }), Object.defineProperty(e, n, r) } : function (e, t, o, n) { void 0 === n && (n = o), e[n] = t[o] }), s = this && this.__setModuleDefault || (Object.create ? function (e, t) { Object.defineProperty(e, "default", { enumerable: !0, value: t }) } : function (e, t) { e.default = t }), c = this && this.__importStar || (n = function (e) { return n = Object.getOwnPropertyNames || function (e) { var t = []; for (var o in e) Object.prototype.hasOwnProperty.call(e, o) && (t[t.length] = o); return t }, n(e) }, function (e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var o = n(e), c = 0; c < o.length; c++)"default" !== o[c] && r(t, e, o[c]); return s(t, e), t }); Object.defineProperty(t, "__esModule", { value: !0 }), t.Receiver = void 0; const i = c(o(278)), u = o(894); t.Receiver = class { server; openSockets = new Set; constructor(e, t) { this.server = i.createServer((e => { this.openSockets.add(e), e.on("close", (() => { this.openSockets.delete(e) })), e.on("error", (() => { this.openSockets.delete(e) })), (0, u.registerSocketReception)(e, t) })), this.server.listen(e) } shutdown() { return this.openSockets.forEach((e => e.destroy())), this.openSockets.clear(), new Promise((e => { this.server.close((() => { e() })) })) } } }, 828: (e, t, o) => { Object.defineProperty(t, "__esModule", { value: !0 }), t.ReceptionSource = void 0; const n = o(894); t.ReceptionSource = class { socket; constructor(e) { this.socket = e } send(e) { this.socket.write((0, n.stringToTerminatedBuffer)(e)) } } }, 894: (e, t, o) => { Object.defineProperty(t, "__esModule", { value: !0 }), t.stringToTerminatedBuffer = function (e) { const t = Buffer.from(`${e}0`); return t.writeUInt8(0, t.length - 1), t }, t.splitBufferByTerminator = function (e) { const t = []; let o = 0; for (let n = 0; n < e.length; n++)0 === e[n] && (t.push(e.slice(o, n)), o = n + 1); return t.push(e.slice(o, e.length)), t }, t.registerSocketReception = function (e, t) { const o = new r.ReceptionSource(e), s = new n.FrameDecodeContext; e.on("data", (e => { s.decode(e).forEach((e => t.onReceived(o, e))) })) }; const n = o(988), r = o(828) }, 278: e => { e.exports = require("net") } }, t = {}; function o(n) { var r = t[n]; if (void 0 !== r) return r.exports; var s = t[n] = { exports: {} }; return e[n].call(s.exports, s, s.exports, o), s.exports } (() => { const e = o(153), t = o(987), n = o(97); class r { rec; constructor() { const o = new Map; o.set(1, { handle(e, t) { t?.respond(e) } }), this.rec = new t.Receiver(n.LOCAL_PORT, new e.CommandProcessor(o)) } async shutdown() { await this.rec.shutdown() } } !function () { const e = new r; process.on("SIGTERM", (async () => { await e.shutdown() })) }() })() })();
