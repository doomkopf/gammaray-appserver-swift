(()=>{"use strict";var e={153:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CommandProcessor=void 0;const r=o(910);t.CommandProcessor=class{commandHandlers;constructor(e){this.commandHandlers=e}onReceived(e,t){const o=JSON.parse(t);if(!o.cmd)return void console.log(`Received invalid commmand: ${t}`);const n=this.commandHandlers.get(o.cmd);n?n.handle(o.pl,o.id?new r.RequestContext(e,o.id):void 0):console.log(`Unknown command: ${o.cmd}`)}}},910:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RequestContext=void 0;const r=o(464);t.RequestContext=class{source;requestId;constructor(e,t){this.source=e,this.requestId=t}respond(e){this.source.send(JSON.stringify((0,r.responseCommand)(this.requestId,e)))}}},464:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.responseCommand=void 0,t.responseCommand=function(e,t){return{id:e,pl:t}}},988:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FrameDecodeContext=void 0;const r=o(894),n=Buffer.alloc(0);t.FrameDecodeContext=class{last=n;decode(e){if(0===e.length)return[];const t=(0,r.splitBufferByTerminator)(e);if(0===t.length)return[];const[o]=t;if(this.last=Buffer.concat([this.last,o]),1===t.length)return[];const s=[];this.last.length>0&&(s.push(this.last.toString()),this.last=n);for(let e=1;e<t.length-1;e++)s.push(t[e].toString());const c=t[t.length-1];return c&&(this.last=c),s}}},987:function(e,t,o){var r=this&&this.__createBinding||(Object.create?function(e,t,o,r){void 0===r&&(r=o);var n=Object.getOwnPropertyDescriptor(t,o);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,r,n)}:function(e,t,o,r){void 0===r&&(r=o),e[r]=t[o]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&r(t,e,o);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Receiver=void 0;const c=s(o(278)),i=o(894);t.Receiver=class{server;openSockets=new Set;constructor(e,t){this.server=c.createServer((e=>{this.openSockets.add(e),e.on("close",(()=>{this.openSockets.delete(e)})),e.on("error",(()=>{this.openSockets.delete(e)})),(0,i.registerSocketReception)(e,t)})),this.server.listen(e)}shutdown(){return this.openSockets.forEach((e=>e.destroy())),this.openSockets.clear(),new Promise((e=>{this.server.close((()=>{e()}))}))}}},828:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReceptionSource=void 0;const r=o(894);t.ReceptionSource=class{socket;constructor(e){this.socket=e}send(e){this.socket.write((0,r.stringToTerminatedBuffer)(e))}}},894:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.registerSocketReception=t.splitBufferByTerminator=t.stringToTerminatedBuffer=void 0;const r=o(988),n=o(828);t.stringToTerminatedBuffer=function(e){const t=Buffer.from(`${e}0`);return t.writeUInt8(0,t.length-1),t},t.splitBufferByTerminator=function(e){const t=[];let o=0;for(let r=0;r<e.length;r++)0===e[r]&&(t.push(e.slice(o,r)),o=r+1);return t.push(e.slice(o,e.length)),t},t.registerSocketReception=function(e,t){const o=new n.ReceptionSource(e),s=new r.FrameDecodeContext;e.on("data",(e=>{s.decode(e).forEach((e=>t.onReceived(o,e)))}))}},278:e=>{e.exports=require("net")}},t={};function o(r){var n=t[r];if(void 0!==n)return n.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,o),s.exports}(()=>{const e=o(153),t=o(987);class r{rec;constructor(){const o=new Map;o.set(1,{handle(e,t){t?.respond(e)}}),this.rec=new t.Receiver(1234,new e.CommandProcessor(o))}async shutdown(){await this.rec.shutdown()}}!function(){const e=new r;process.on("SIGTERM",(async()=>{await e.shutdown()}))}()})()})();